{"version":3,"file":"main.js","mappings":";;;;AACA,IAAMA,MAAM,GAAGC,QAAQ,CAACC,aAAa;AACrC,IAAMC,KAAK,GAAGH,MAAM,CAACI,YAAY,CAAC,YAAY,CAAC;AAC/C,IAAMC,KAAK,GAAGL,MAAM,CAACI,YAAY,CAAC,YAAY,CAAC;AAC/C,IAAME,GAAG,GAAGL,QAAQ,CAACM,cAAc,CAAC,MAAM,GAAGJ,KAAK,CAAC;AAEnD,IAAGG,GAAG,EAAE;EAAA,IAsGCE,KAAK,GAAd,SAASA,KAAKA,CAACC,EAAE,EAAEC,EAAE,EAAEC,GAAG,EAAE;IAC1B,IAAMC,CAAC,GAAGC,IAAI,CAACC,IAAI,CAACL,EAAE,GAACA,EAAE,GAAGC,EAAE,GAACA,EAAE,CAAC;IAClC,IAAIE,CAAC,GAAGD,GAAG,EAAE,OAAO;MAAEF,EAAE,EAAGA,EAAE,GAACG,CAAC,GAAED,GAAG;MAAED,EAAE,EAAGA,EAAE,GAACE,CAAC,GAAED;IAAI,CAAC;IACtD,OAAO;MAAEF,EAAE,EAAFA,EAAE;MAAEC,EAAE,EAAFA;IAAG,CAAC;EACnB,CAAC,EAED;EAAA,IACSK,QAAO,GAAhB,SAASA,OAAOA,CAAA,EAAG;IAEjB;IACAC,UAAU,CAACC,SAAS,GAAG,EAAE;;IAEzB;IACA,KAAK,IAAIC,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGC,KAAK,CAACC,MAAM,EAAEF,EAAC,EAAE,EAAE;MACrC,KAAK,IAAIG,CAAC,GAAGH,EAAC,GAAG,CAAC,EAAEG,CAAC,GAAGF,KAAK,CAACC,MAAM,EAAEC,CAAC,EAAE,EAAE;QAEzC,IAAMC,EAAE,GAAGH,KAAK,CAACD,EAAC,CAAC;QACnB,IAAMK,EAAE,GAAGJ,KAAK,CAACE,CAAC,CAAC;QAEnB,IAAMG,EAAE,GAAGD,EAAE,CAACE,CAAC,GAAGH,EAAE,CAACG,CAAC;QACtB,IAAMC,EAAE,GAAGH,EAAE,CAACI,CAAC,GAAGL,EAAE,CAACK,CAAC;QACtB,IAAMC,CAAC,GAAGf,IAAI,CAACC,IAAI,CAACU,EAAE,GAACA,EAAE,GAAGE,EAAE,GAACA,EAAE,CAAC;QAElC,IAAIE,CAAC,GAAGC,aAAa,EAAE;UACrB,IAAMC,IAAI,GAAG7B,QAAQ,CAAC8B,eAAe,CAAC,4BAA4B,EAAE,MAAM,CAAC;UAE3ED,IAAI,CAACE,YAAY,CAAC,SAAS,EAAE,GAAG,CAAC;UAEjCF,IAAI,CAACE,YAAY,CAAC,IAAI,EAAEV,EAAE,CAACG,CAAC,CAAC;UAC7BK,IAAI,CAACE,YAAY,CAAC,IAAI,EAAEV,EAAE,CAACK,CAAC,CAAC;UAC7BG,IAAI,CAACE,YAAY,CAAC,IAAI,EAAET,EAAE,CAACE,CAAC,CAAC;UAC7BK,IAAI,CAACE,YAAY,CAAC,IAAI,EAAET,EAAE,CAACI,CAAC,CAAC;;UAE7B;UACA,IAAMM,KAAK,GAAG,CAAC,GAAIL,CAAC,GAAGC,aAAc;UACrCC,IAAI,CAACE,YAAY,CAAC,QAAQ,EAAE3B,KAAK,CAAC;UAClCyB,IAAI,CAACE,YAAY,CAAC,cAAc,EAAE,GAAG,CAAC;UACtChB,UAAU,CAACkB,WAAW,CAACJ,IAAI,CAAC;QAC9B;MACF;IACF;;IAEA;IACA,SAAAK,GAAA,MAAAC,MAAA,GAAcjB,KAAK,EAAAgB,GAAA,GAAAC,MAAA,CAAAhB,MAAA,EAAAe,GAAA,IAAE;MAAhB,IAAIE,CAAC,GAAAD,MAAA,CAAAD,GAAA;MAER,IAAIG,MAAM,GAAG,CAAC;QAAEC,MAAM,GAAG,CAAC;MAC1B,IAAIC,IAAI,GAAG,CAAC;QAAEC,IAAI,GAAG,CAAC;MACtB,IAAIC,IAAI,GAAG,CAAC;QAAEC,IAAI,GAAG,CAAC;MACtB,IAAIC,KAAK,GAAG,CAAC;MAEb,SAAAC,GAAA,MAAAC,OAAA,GAAc3B,KAAK,EAAA0B,GAAA,GAAAC,OAAA,CAAA1B,MAAA,EAAAyB,GAAA,IAAE;QAAhB,IAAIE,CAAC,GAAAD,OAAA,CAAAD,GAAA;QAER,IAAIE,CAAC,KAAKV,CAAC,EAAE;QAEb,IAAMb,GAAE,GAAGuB,CAAC,CAACtB,CAAC,GAAGY,CAAC,CAACZ,CAAC;QACpB,IAAMC,GAAE,GAAGqB,CAAC,CAACpB,CAAC,GAAGU,CAAC,CAACV,CAAC;QACpB,IAAMqB,IAAI,GAAGnC,IAAI,CAACC,IAAI,CAACU,GAAE,GAACA,GAAE,GAAGE,GAAE,GAACA,GAAE,CAAC;QACrC,IAAIsB,IAAI,GAAGC,aAAa,EAAE;;QAE1B;QACA,IAAMC,OAAO,GAAGrC,IAAI,CAACsC,KAAK,CAACzB,GAAE,EAAEF,GAAE,CAAC;QAClC,IAAM4B,OAAO,GAAGvC,IAAI,CAACsC,KAAK,CAACd,CAAC,CAAC3B,EAAE,EAAE2B,CAAC,CAAC5B,EAAE,CAAC;QACtC,IAAI4C,IAAI,GAAGH,OAAO,GAAGE,OAAO;QAC5B,IAAIvC,IAAI,CAACyC,GAAG,CAACD,IAAI,CAAC,GAAGxC,IAAI,CAAC0C,EAAE,EAAEF,IAAI,IAAIxC,IAAI,CAAC2C,IAAI,CAACH,IAAI,CAAC,GAAC,CAAC,GAACxC,IAAI,CAAC0C,EAAE;QAC/D,IAAI1C,IAAI,CAACyC,GAAG,CAACD,IAAI,CAAC,GAAGI,YAAY,GAAC,CAAC,EAAE;QAErCb,KAAK,EAAE;QAEPN,MAAM,IAAIS,CAAC,CAACtC,EAAE;QACd8B,MAAM,IAAIQ,CAAC,CAACrC,EAAE;QAEd8B,IAAI,IAAIO,CAAC,CAACtB,CAAC;QACXgB,IAAI,IAAIM,CAAC,CAACpB,CAAC;QAEX,IAAIqB,IAAI,GAAG,CAAC,EAAE;UACZN,IAAI,IAAIlB,GAAE,GAAGwB,IAAI;UACjBL,IAAI,IAAIjB,GAAE,GAAGsB,IAAI;QACnB;MACF;;MAEA;MACAX,CAAC,CAACqB,EAAE,GAAG,CAAC;MACRrB,CAAC,CAACsB,EAAE,GAAG,CAAC;MAER,IAAIf,KAAK,GAAG,CAAC,EAAE;QAEb;QACAN,MAAM,IAAIM,KAAK;QAAEL,MAAM,IAAIK,KAAK;QAChC,IAAIgB,EAAE,GAAGpD,KAAK,CAAC8B,MAAM,GAAGD,CAAC,CAAC5B,EAAE,EAAE8B,MAAM,GAAGF,CAAC,CAAC3B,EAAE,EAAEmD,SAAS,CAAC;QACvDxB,CAAC,CAACqB,EAAE,IAAIE,EAAE,CAACnD,EAAE,GAAGqD,YAAY;QAC5BzB,CAAC,CAACsB,EAAE,IAAIC,EAAE,CAAClD,EAAE,GAAGoD,YAAY;;QAE5B;QACAtB,IAAI,GAAGA,IAAI,GAAGI,KAAK,GAAGP,CAAC,CAACZ,CAAC;QACzBgB,IAAI,GAAGA,IAAI,GAAGG,KAAK,GAAGP,CAAC,CAACV,CAAC;QACzB,IAAIoC,EAAE,GAAGvD,KAAK,CAACgC,IAAI,EAAEC,IAAI,EAAEoB,SAAS,CAAC;QACrCxB,CAAC,CAACqB,EAAE,IAAIK,EAAE,CAACtD,EAAE,GAAGuD,eAAe;QAC/B3B,CAAC,CAACsB,EAAE,IAAII,EAAE,CAACrD,EAAE,GAAGsD,eAAe;;QAE/B;QACA,IAAIC,EAAE,GAAGzD,KAAK,CAACkC,IAAI,EAAEC,IAAI,EAAEkB,SAAS,CAAC;QACrCxB,CAAC,CAACqB,EAAE,IAAIO,EAAE,CAACxD,EAAE,GAAGyD,iBAAiB;QACjC7B,CAAC,CAACsB,EAAE,IAAIM,EAAE,CAACvD,EAAE,GAAGwD,iBAAiB;MACnC;;MAEA;;MAEA,IAAMC,GAAG,GAAGC,MAAM,GAAG/B,CAAC,CAACZ,CAAC;MACxB,IAAM4C,GAAG,GAAGC,MAAM,GAAGjC,CAAC,CAACV,CAAC;MACxB,IAAM4C,KAAK,GAAG1D,IAAI,CAACC,IAAI,CAACqD,GAAG,GAACA,GAAG,GAAGE,GAAG,GAACA,GAAG,CAAC;;MAE1C;MACA,IAAIE,KAAK,GAAGC,YAAY,EAAE;QACxBnC,CAAC,CAACqB,EAAE,IAAKS,GAAG,GAAGI,KAAK,GAAIE,WAAW;QACnCpC,CAAC,CAACsB,EAAE,IAAKU,GAAG,GAAGE,KAAK,GAAIE,WAAW;MACrC;;MAEA;MACA;MACA;MACA;MACA;;MAEA;MACApC,CAAC,CAAC5B,EAAE,IAAI4B,CAAC,CAACqB,EAAE;MACZrB,CAAC,CAAC3B,EAAE,IAAI2B,CAAC,CAACsB,EAAE;MAEZ,IAAMe,EAAE,GAAG7D,IAAI,CAACC,IAAI,CAACuB,CAAC,CAAC5B,EAAE,GAAC4B,CAAC,CAAC5B,EAAE,GAAG4B,CAAC,CAAC3B,EAAE,GAAC2B,CAAC,CAAC3B,EAAE,CAAC;MAC3C,IAAIgE,EAAE,GAAGC,SAAS,EAAE;QAClBtC,CAAC,CAAC5B,EAAE,GAAI4B,CAAC,CAAC5B,EAAE,GAACiE,EAAE,GAAIC,SAAS;QAC5BtC,CAAC,CAAC3B,EAAE,GAAI2B,CAAC,CAAC3B,EAAE,GAACgE,EAAE,GAAIC,SAAS;MAC9B,CAAC,MAAM,IAAID,EAAE,GAAGE,SAAS,EAAE;QACzBvC,CAAC,CAAC5B,EAAE,GAAI4B,CAAC,CAAC5B,EAAE,GAACiE,EAAE,GAAIE,SAAS;QAC5BvC,CAAC,CAAC3B,EAAE,GAAI2B,CAAC,CAAC3B,EAAE,GAACgE,EAAE,GAAIE,SAAS;MAC9B;;MAEA;MACAvC,CAAC,CAACZ,CAAC,IAAIY,CAAC,CAAC5B,EAAE;MACX4B,CAAC,CAACV,CAAC,IAAIU,CAAC,CAAC3B,EAAE;;MAEX;MACA;MACA;MACA;MACA;;MAEA;MACA,IAAI2B,CAAC,CAACZ,CAAC,GAAG,CAAC,EAAG;QAAEY,CAAC,CAACZ,CAAC,GAAGoD,KAAK;MAAE;MAC7B,IAAIxC,CAAC,CAACZ,CAAC,GAAGoD,KAAK,EAAE;QAAExC,CAAC,CAACZ,CAAC,GAAG,CAAC;MAAE;MAC5B,IAAIY,CAAC,CAACV,CAAC,GAAG,CAAC,EAAG;QAAEU,CAAC,CAACV,CAAC,GAAGmD,MAAM;MAAE;MAC9B,IAAIzC,CAAC,CAACV,CAAC,GAAGmD,MAAM,EAAE;QAAEzC,CAAC,CAACV,CAAC,GAAG,CAAC;MAAE;;MAE7B;MACAU,CAAC,CAAC0C,EAAE,CAAC/C,YAAY,CAAC,IAAI,EAAEK,CAAC,CAACZ,CAAC,CAAC;MAC5BY,CAAC,CAAC0C,EAAE,CAAC/C,YAAY,CAAC,IAAI,EAAEK,CAAC,CAACV,CAAC,CAAC;IAC9B;IAEAqD,qBAAqB,CAACjE,QAAO,CAAC;EAChC,CAAC;EAlQD,IAAIC,UAAU,GAAIf,QAAQ,CAAC8B,eAAe,CAAC,4BAA4B,EAAE,GAAG,CAAC;EAC7Ef,UAAU,CAAEgB,YAAY,CAAC,IAAI,EAAE,OAAO,CAAC;EACvC1B,GAAG,CAAC4B,WAAW,CAAClB,UAAW,CAAC;EAE5B,IAAMiE,SAAS,GAAG,CAAC;EAEnB,IAAMJ,KAAK,GAAG,GAAG;EACjB,IAAMC,MAAM,GAAG,GAAG;;EAElB;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,IAAMF,SAAS,GAAG,GAAG;EACrB,IAAMD,SAAS,GAAG,GAAG;EACrB,IAAMd,SAAS,GAAG,MAAM;;EAExB;EACA;EACA;EACA;EACA;EACA;EACA;EACA,IAAMZ,aAAa,GAAG,EAAE;EACxB,IAAMQ,YAAY,GAAG5C,IAAI,CAAC0C,EAAE,GAAG,IAAI;;EAEnC;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,IAAMS,eAAe,GAAG,GAAG;EAC3B,IAAMF,YAAY,GAAG,IAAI;EACzB,IAAMI,iBAAiB,GAAG,GAAG;;EAE7B;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,IAAIE,MAAM,GAAGS,KAAK,GAAG,CAAC;EACtB,IAAIP,MAAM,GAAGQ,MAAM,GAAG,CAAC;EACvB,IAAML,WAAW,GAAG,IAAI;EACxB,IAAMD,YAAY,GAAG,EAAE;;EAEvB;EACA,IAAM3C,aAAa,GAAG,EAAE;;EAExB;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACAvB,GAAG,CAAC4E,gBAAgB,CAAC,WAAW,EAAE,UAACC,CAAC,EAAK;IACvC,IAAIC,EAAE,GAAG9E,GAAG,CAAC+E,cAAc,CAAC,CAAC;IAC7BD,EAAE,CAAC3D,CAAC,GAAG0D,CAAC,CAACG,OAAO;IAChBF,EAAE,CAACzD,CAAC,GAAGwD,CAAC,CAACI,OAAO;IAChB,IAAMC,CAAC,GAAGJ,EAAE,CAACK,eAAe,CAACnF,GAAG,CAACoF,YAAY,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC,CAAC;IAC1DvB,MAAM,GAAGoB,CAAC,CAAC/D,CAAC;IACZ6C,MAAM,GAAGkB,CAAC,CAAC7D,CAAC;EACd,CAAC,CAAC;;EAEF;EACA,IAAIR,KAAK,GAAG,EAAE;EACd,KAAK,IAAID,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG+D,SAAS,EAAE/D,CAAC,EAAE,EAAE;IAClC,IAAIO,CAAC,GAAGZ,IAAI,CAAC+E,MAAM,CAAC,CAAC,GAAGf,KAAK;IAC7B,IAAIlD,CAAC,GAAGd,IAAI,CAAC+E,MAAM,CAAC,CAAC,GAAGd,MAAM;IAC9B,IAAIe,CAAC,GAAGhF,IAAI,CAAC+E,MAAM,CAAC,CAAC,GAAG/E,IAAI,CAAC0C,EAAE,GAAG,CAAC;IAEnC,IAAI9C,EAAE,GAAGI,IAAI,CAACiF,GAAG,CAACD,CAAC,CAAC,GAAG,GAAG;IAC1B,IAAInF,EAAE,GAAGG,IAAI,CAACkF,GAAG,CAACF,CAAC,CAAC,GAAG,GAAG;IAE1B,IAAId,EAAE,GAAG9E,QAAQ,CAAC8B,eAAe,CAAC,4BAA4B,EAAE,QAAQ,CAAC;IACzEgD,EAAE,CAAC/C,YAAY,CAAC,GAAG,EAAE,GAAG,CAAC;IACzB+C,EAAE,CAAC/C,YAAY,CAAC,MAAM,EAAE3B,KAAK,CAAC;IAC9BC,GAAG,CAAC4B,WAAW,CAAC6C,EAAE,CAAC;IAEnB5D,KAAK,CAAC6E,IAAI,CAAC;MAAEvE,CAAC,EAADA,CAAC;MAAEE,CAAC,EAADA,CAAC;MAAElB,EAAE,EAAFA,EAAE;MAAEC,EAAE,EAAFA,EAAE;MAAEgD,EAAE,EAAE,CAAC;MAAEC,EAAE,EAAE,CAAC;MAAEoB,EAAE,EAAFA;IAAG,CAAC,CAAC;EAChD;EAkKAhE,QAAO,CAAC,CAAC;AAET,C","sources":["webpack://poeticsoft.com/./src/svgscript/flock/main.js"],"sourcesContent":["\r\nconst script = document.currentScript\r\nconst svgid = script.getAttribute('data-svgid')\r\nconst color = script.getAttribute('data-color')\r\nconst svg = document.getElementById('svg_' + svgid)\r\n\r\nif(svg) { \r\n  \r\nlet linksGroup  = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\nlinksGroup .setAttribute('id', 'links');\r\nsvg.appendChild(linksGroup );\r\n\r\nconst NUM_BOIDS = 4;\r\n\r\nconst WIDTH = 100;\r\nconst HEIGHT = 100;\r\n\r\n// MAX_SPEED: velocidad máxima que puede alcanzar un boid.\r\n// Reducirlo → movimientos más lentos, más fluidos.\r\n// Aumentarlo → más energía y caos.\r\n// MIN_SPEED: velocidad mínima para que los boids no se queden estáticos.\r\n// MAX_FORCE: fuerza máxima que puede aplicar una aceleración por frame.\r\n// Controla qué tan rápido pueden cambiar de dirección.\r\n// Valores muy bajos → giros suaves y bandada estable.\r\n// Valores altos → giros bruscos y dispersión.\r\nconst MAX_SPEED = 0.3;\r\nconst MIN_SPEED = 0.1;\r\nconst MAX_FORCE = 0.0003;\r\n\r\n// VISION_RADIUS: distancia máxima a la que un boid “ve” a sus vecinos para alineamiento/cohesión/separación.\r\n// Mayor → boids más conscientes del grupo, más cohesionados.\r\n// Menor → bandada más dispersa y reactiva solo a vecinos cercanos.\r\n// VISION_ANGLE: ángulo frontal de visión (en radianes).\r\n// Math.PI * 0.55 ≈ 100°.\r\n// Reduce el ángulo → boids solo reaccionan a lo que está frente a ellos → movimiento más realista.\r\n// Aumenta → más caos, porque ven a casi todos los vecinos.\r\nconst VISION_RADIUS = 30;\r\nconst VISION_ANGLE = Math.PI * 0.55;\r\n\r\n// COHESION_WEIGHT → cuánto tienden a moverse hacia el centro del grupo.\r\n// Mayor → bandada más compacta.\r\n// Menor → boids más dispersos.\r\n// ALIGN_WEIGHT → cuánto intentan igualar su dirección con la del grupo.\r\n// Mayor → movimientos más sincronizados.\r\n// Menor → movimientos más descoordinados.\r\n// SEPARATION_WEIGHT → cuánto evitan chocar con vecinos cercanos.\r\n// Mayor → bandada más separada y nerviosa.\r\n// Menor → bandada más pegada y cohesionada.\r\nconst COHESION_WEIGHT = 0.1;\r\nconst ALIGN_WEIGHT = 0.12;\r\nconst SEPARATION_WEIGHT = 0.1;\r\n\r\n// mouseX, mouseY → posición actual del mouse en coordenadas SVG.\r\n// MOUSE_FORCE → fuerza que aplica sobre los boids.\r\n// Positiva → atracción.\r\n// Negativa → repulsión.\r\n// Ajusta este valor para que la interacción sea más o menos intensa.\r\n// MOUSE_RADIUS → radio de influencia del mouse.\r\n// Boids fuera de este radio ignoran al cursor.\r\n// Mayor → influencia más global.\r\n// Menor → interacción más localizada.\r\nlet mouseX = WIDTH / 2;\r\nlet mouseY = HEIGHT / 2;\r\nconst MOUSE_FORCE = 0.03;\r\nconst MOUSE_RADIUS = 20;\r\n\r\n// distancia máxima para líneas\r\nconst LINK_DISTANCE = 20;\r\n\r\n// Para bandadas más cohesionadas:\r\n// Aumenta COHESION_WEIGHT\r\n// Aumenta VISION_RADIUS\r\n// Reduce SEPARATION_WEIGHT si los boids están demasiado separados\r\n// Para interacción más fuerte con mouse:\r\n// Aumenta MOUSE_FORCE y/o MOUSE_RADIUS\r\n// Para movimiento más suave y orgánico:\r\n// Reduce MAX_FORCE\r\n// Reduce MAX_SPEED ligeramente\r\n// Mantén MIN_SPEED > 0 para que nunca se queden congelados\r\n\r\n// ------------ mouse tracking -------------\r\nsvg.addEventListener('mousemove', (e) => {\r\n  let pt = svg.createSVGPoint();\r\n  pt.x = e.clientX;\r\n  pt.y = e.clientY;\r\n  const p = pt.matrixTransform(svg.getScreenCTM().inverse());\r\n  mouseX = p.x;\r\n  mouseY = p.y;\r\n});\r\n\r\n// ------------ BOIDS ----------------\r\nlet boids = [];\r\nfor (let i = 0; i < NUM_BOIDS; i++) {\r\n  let x = Math.random() * WIDTH;\r\n  let y = Math.random() * HEIGHT;\r\n  let a = Math.random() * Math.PI * 2;\r\n\r\n  let vx = Math.cos(a) * 0.8;\r\n  let vy = Math.sin(a) * 0.8;\r\n\r\n  let el = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\r\n  el.setAttribute('r', 0.7);\r\n  el.setAttribute('fill', color);\r\n  svg.appendChild(el);\r\n\r\n  boids.push({ x, y, vx, vy, ax: 0, ay: 0, el });\r\n}\r\n\r\nfunction limit(vx, vy, max) {\r\n  const m = Math.sqrt(vx*vx + vy*vy);\r\n  if (m > max) return { vx: (vx/m)*max, vy: (vy/m)*max };\r\n  return { vx, vy };\r\n}\r\n\r\n// ------------ ANIMACIÓN ----------------\r\nfunction animate() {\r\n\r\n  // limpiar links anteriores\r\n  linksGroup.innerHTML = '';\r\n\r\n  // dibujar nuevas líneas\r\n  for (let i = 0; i < boids.length; i++) {\r\n    for (let j = i + 1; j < boids.length; j++) {\r\n\r\n      const b1 = boids[i];\r\n      const b2 = boids[j];\r\n\r\n      const dx = b2.x - b1.x;\r\n      const dy = b2.y - b1.y;\r\n      const d = Math.sqrt(dx*dx + dy*dy);\r\n\r\n      if (d < LINK_DISTANCE) {\r\n        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\r\n\r\n        line.setAttribute('opacity', 0.1);\r\n\r\n        line.setAttribute('x1', b1.x);\r\n        line.setAttribute('y1', b1.y);\r\n        line.setAttribute('x2', b2.x);\r\n        line.setAttribute('y2', b2.y);\r\n\r\n        // opacidad según distancia\r\n        const alpha = 1 - (d / LINK_DISTANCE);\r\n        line.setAttribute('stroke', color);\r\n        line.setAttribute('stroke-width', 0.3);\r\n        linksGroup.appendChild(line);\r\n      }\r\n    }\r\n  }\r\n\r\n  // actualizar boids\r\n  for (let b of boids) {\r\n\r\n    let alignX = 0, alignY = 0;\r\n    let cohX = 0, cohY = 0;\r\n    let sepX = 0, sepY = 0;\r\n    let count = 0;\r\n\r\n    for (let o of boids) {\r\n\r\n      if (o === b) continue;\r\n\r\n      const dx = o.x - b.x;\r\n      const dy = o.y - b.y;\r\n      const dist = Math.sqrt(dx*dx + dy*dy);\r\n      if (dist > VISION_RADIUS) continue;\r\n\r\n      // campo de visión\r\n      const angleTo = Math.atan2(dy, dx);\r\n      const heading = Math.atan2(b.vy, b.vx);\r\n      let diff = angleTo - heading;\r\n      if (Math.abs(diff) > Math.PI) diff -= Math.sign(diff)*2*Math.PI;\r\n      if (Math.abs(diff) > VISION_ANGLE/2) continue;\r\n\r\n      count++;\r\n\r\n      alignX += o.vx;\r\n      alignY += o.vy;\r\n\r\n      cohX += o.x;\r\n      cohY += o.y;\r\n\r\n      if (dist < 6) {\r\n        sepX -= dx / dist;\r\n        sepY -= dy / dist;\r\n      }\r\n    }\r\n\r\n    // reset aceleración\r\n    b.ax = 0; \r\n    b.ay = 0;\r\n\r\n    if (count > 0) {\r\n\r\n      // alineamiento\r\n      alignX /= count; alignY /= count;\r\n      let a1 = limit(alignX - b.vx, alignY - b.vy, MAX_FORCE);\r\n      b.ax += a1.vx * ALIGN_WEIGHT;\r\n      b.ay += a1.vy * ALIGN_WEIGHT;\r\n\r\n      // cohesión\r\n      cohX = cohX / count - b.x;\r\n      cohY = cohY / count - b.y;\r\n      let a2 = limit(cohX, cohY, MAX_FORCE);\r\n      b.ax += a2.vx * COHESION_WEIGHT;\r\n      b.ay += a2.vy * COHESION_WEIGHT;\r\n\r\n      // separación\r\n      let a3 = limit(sepX, sepY, MAX_FORCE);\r\n      b.ax += a3.vx * SEPARATION_WEIGHT;\r\n      b.ay += a3.vy * SEPARATION_WEIGHT;\r\n    }\r\n\r\n    // ----------- mouse ------------------\r\n\r\n    const mdx = mouseX - b.x;\r\n    const mdy = mouseY - b.y;\r\n    const mdist = Math.sqrt(mdx*mdx + mdy*mdy);\r\n\r\n    // atracción \r\n    if (mdist < MOUSE_RADIUS) {\r\n      b.ax += (mdx / mdist) * MOUSE_FORCE;\r\n      b.ay += (mdy / mdist) * MOUSE_FORCE;\r\n    }\r\n\r\n    // Repulsion\r\n    // if (mdist < MOUSE_RADIUS) {\r\n    //   b.ax -= (mdx / mdist) * MOUSE_FORCE;  // <-- signo invertido\r\n    //   b.ay -= (mdy / mdist) * MOUSE_FORCE;  // <-- signo invertido\r\n    // }\r\n\r\n    // velocidad\r\n    b.vx += b.ax;\r\n    b.vy += b.ay;\r\n\r\n    const sp = Math.sqrt(b.vx*b.vx + b.vy*b.vy);\r\n    if (sp < MIN_SPEED) {\r\n      b.vx = (b.vx/sp) * MIN_SPEED;\r\n      b.vy = (b.vy/sp) * MIN_SPEED;\r\n    } else if (sp > MAX_SPEED) {\r\n      b.vx = (b.vx/sp) * MAX_SPEED;\r\n      b.vy = (b.vy/sp) * MAX_SPEED;\r\n    }\r\n\r\n    // movimiento\r\n    b.x += b.vx;\r\n    b.y += b.vy;\r\n\r\n    // rebote\r\n    // if (b.x < 0)  { b.x = 0; b.vx *= -1; }\r\n    // if (b.x > WIDTH) { b.x = WIDTH; b.vx *= -1; }\r\n    // if (b.y < 0)  { b.y = 0; b.vy *= -1; }\r\n    // if (b.y > HEIGHT) { b.y = HEIGHT; b.vy *= -1; }\r\n\r\n    // rebase\r\n    if (b.x < 0)  { b.x = WIDTH; }\r\n    if (b.x > WIDTH) { b.x = 0; }\r\n    if (b.y < 0)  { b.y = HEIGHT; }\r\n    if (b.y > HEIGHT) { b.y = 0; }\r\n\r\n    // posicion SVG\r\n    b.el.setAttribute('cx', b.x);\r\n    b.el.setAttribute('cy', b.y);\r\n  }\r\n\r\n  requestAnimationFrame(animate);\r\n}\r\n\r\nanimate();\r\n\r\n}"],"names":["script","document","currentScript","svgid","getAttribute","color","svg","getElementById","limit","vx","vy","max","m","Math","sqrt","animate","linksGroup","innerHTML","i","boids","length","j","b1","b2","dx","x","dy","y","d","LINK_DISTANCE","line","createElementNS","setAttribute","alpha","appendChild","_i2","_boids","b","alignX","alignY","cohX","cohY","sepX","sepY","count","_i3","_boids2","o","dist","VISION_RADIUS","angleTo","atan2","heading","diff","abs","PI","sign","VISION_ANGLE","ax","ay","a1","MAX_FORCE","ALIGN_WEIGHT","a2","COHESION_WEIGHT","a3","SEPARATION_WEIGHT","mdx","mouseX","mdy","mouseY","mdist","MOUSE_RADIUS","MOUSE_FORCE","sp","MIN_SPEED","MAX_SPEED","WIDTH","HEIGHT","el","requestAnimationFrame","NUM_BOIDS","addEventListener","e","pt","createSVGPoint","clientX","clientY","p","matrixTransform","getScreenCTM","inverse","random","a","cos","sin","push"],"sourceRoot":""}